<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title> Kearsney Booklet</title>
    <!--[if lt IE 9]><script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <link href="css/jquery.booklet.latest.css" type="text/css" rel="stylesheet" media="screen, projection, tv" />
    <link href="css/bootstrap.css" type="text/css" rel="stylesheet" />
    <link href="css/bootstrap.css" type="text/css" rel="stylesheet" />
    <style type="text/css">
        body {background:#ccc; font:normal 12px/1.2 arial, verdana, sans-serif;}
    </style>
</head>
<body>
	<div>
        <br/>
    </div>
    <div class="container">
  <div class="jumbotron">
    <h1>Kearsney College Logo and Banner</h1>      
    
  </div>

  <div class="row" ng-app="MyApp">
      <!-- append menu according to the number of chronicles -->
      <!-- SIDE MENU -->
      <div class="col-md-2" ng-controller="chronicleController">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" >
              <div class="panel panel-default" ng-repeat="achronicle in chroniclesdataList">
                <div class="panel-heading" role="tab" id="heading{{achronicle.id}}">
                  <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{achronicle.id}}" aria-expanded="false" aria-controls="collapse{{achronicle.id}}" id="{{achronicle.id}}">
                     <span id="{{achronicle.id}}" class="" onclick="loadPagesForChronicle(id);">{{achronicle.name}}</span>
                    </a>
                  </h4>
                </div>
                <div id="collapse{{achronicle.id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{achronicle.id}}">
                  <div class="panel-body">
                      <ul id="chroniclesection{{achronicle.id}}">
                          <li><label><a id="1">Cover</a></label></li>
                      </ul>

                  </div>
                </div>
              </div>
            <!-- Nex Chronicle goes here -->
        </div>
        <!-- End Accordion Chronicle -->
           
    </div>
      
      <!-- Using Accordion to Get ALl Chronicles -->
    
      <!-- END ACCORDION -->
      
   
      <!-- INJECTING BOOKLET HERE -->
    <div class="col-md-10"> 
     
        <section>
            <div id="mybook" >

            </div>
        </section>
    
    </div>
    
    
    <div class="clearfix visible-lg"></div>
  </div>
</div>
	<footer></footer>
    <script src="js/jquery-2.1.0.min.js"></script>
    <script src="js/jquery-ui-1.10.4.min.js"></script>
    <script src="js/angular.js"></script>
     <script src="js/app.js" type="text/javascript"></script>
    <script src="js/mycontroller.js" type="text/javascript"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.booklet.latest.js"></script>
	<script type="text/javascript"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script>
        
	    $(function () {	
            
            //Prepoluate divs withpages
           
            //$("#mybook").booklet("options","manual",false);
           $( "#accordion span" ).click(function( event ) {
               
               var clickedArrcodion = event.target.id;
               
                alert( "clicked: " + clickedArrcodion);
                loadPagesForChronicle(clickedArrcodion);
               

           });
            
            //Detect which Section was clicked
            $('#chroniclesection').click(function(e){
                 
                 var clickedSection = e.target.id;
                 e.preventDefault();
                 //alert(clickedSection);
                 navigateToSection(clickedSection);
                
             });
            
            
            
        });
        
          function loadPagesForChronicle(id){
            //After you clicked on an accordion the chronicle Id will be passed in order to load pages for that specific chronicle
             var pagesContainer = $("#mybook");
             var currentpagesection =0;
             var pageHeight = '500px;';
             var pageWidth =  '355px;';
            
            $.ajax({
                url: "http://localhost:1650/api/chronicle/"+id,
                type: "GET",
                contentType: 'application/json; charset=utf-8',
                success: function (data) { 
                
                    var chronicle=null;
                    console.log(data);
                    var chroniclesList =data;// $.parseJSON(data);
                   
                    
                    chronicle = chroniclesList;
                     $( "ul" ).empty();
                    for(var count=1; count < chronicle.Pages.length ; count ++)
                    {
                        var singlepage = chronicle.Pages[count];
                        var newline = "<div>"+"<img src=\'"+singlepage.PageUrl+".jpg\' "+ "style=\'" + "width:" + pageWidth +"Height:"+pageHeight + "\'" + "/>"+ "</div>";
                        pagesContainer.append(newline);
                        
                        //append section
                         if(singlepage.SectionId != currentpagesection){
                               
                             currentpagesection = singlepage.SectionId;
                             var openachortag = "<a"+" id=\'" + singlepage.PageId +"\'" + "class=\'"+"chronicleSectionCss\'"+ "onclick=\'navigateToSection("+"id);"+"\'" +">";
                             
                             var newsectionline = "<li id=\'"+singlepage.SectionId+"\' >"+"<label>" + openachortag+" Section " + currentpagesection+"</a>"+"</label></li>";
                             var chroniclesectionid = "#chroniclesection"+id;
                             $(chroniclesectionid).append(newsectionline);
                        }
                        
                    }
                    $("#mybook").booklet();
                    $("#mybook").booklet( "option", "width", 800 );
                    $("#mybook").booklet( "option", "height", 600 );
                },
                error: function () { alert('error'); }
            });
            
        }
        
        function navigateToSection(id){
            
             $('#mybook').booklet("gotopage", id);

        }
        
            
        
        
        
      
    </script>
</body>
</html>